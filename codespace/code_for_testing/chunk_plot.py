import matplotlib.pyplot as plt
import numpy as np


plt.rcParams.update({
    'font.size': 16,            # General font size
    'axes.titlesize': 18,       # Title font
    'axes.labelsize': 16,       # X and Y labels
    'xtick.labelsize': 14,      # X tick labels
    'ytick.labelsize': 14,      # Y tick labels
    'legend.fontsize': 14,      # Legend
    'figure.titlesize': 18      # Overall figure title (if used)
})

data = [
    [0.4699239507317543, 0.44836406596004963, 0.4385558422654867, 0.4799037706106901, 0.42512896470725536, 0.41953008621931076, 0.4210930783301592, 0.4143989644944668, 0.455216970294714, 0.41524204425513744],
    [0.23553345818072557, 0.2094694646075368, 0.23773254361003637, 0.2123195445165038, 0.2311449497938156, 0.21327100694179535, 0.2133019734174013, 0.20961451809853315, 0.213862513191998, 0.22737798281013966],
    [0.12779299868270755, 0.10998977813869715, 0.11583796003833413, 0.1110740122385323, 0.107622763607651, 0.11149724014103413, 0.10668602772057056, 0.10667328024283051, 0.1083437236957252, 0.112243986222893],
    [0.0665391271468252, 0.057724741054698825, 0.05488449824042618, 0.05907737067900598, 0.05543814040720463, 0.05366475670598447, 0.05409674486145377, 0.056714226957410574, 0.05427227006293833, 0.05301361670717597],
    [0.03350868064444512, 0.02991380461025983, 0.02976918767672032, 0.028568756533786654, 0.02912426134571433, 0.02813425089698285, 0.029697810532525182, 0.02860193490050733, 0.027491129003465176, 0.029739749152213335],
    [0.019359256839379668, 0.016462872736155987, 0.016268095350824296, 0.016302881704177707, 0.01660027919569984, 0.016054909792728722, 0.01635765511309728, 0.017128775652963668, 0.017189871869049966, 0.015871752111706883],
    [0.010256015229970217, 0.01065304604708217, 0.010139559890376404, 0.010139545338461176, 0.009938092262018472, 0.009503655746812001, 0.010674171790014952, 0.009732531907502562, 0.00955140421865508, 0.010113577445736155],
    [0.006977108569117263, 0.006164422302390449, 0.006359234248520806, 0.00666747655486688, 0.007268992703757249, 0.006075266355765052, 0.006092797775636427, 0.005991279977024533, 0.006254742402234115, 0.006283311449806206],
    [0.004722987796412781, 0.004418078788148705, 0.004339890438131988, 0.004568758413370233, 0.004258831722836476, 0.0042257688619429246, 0.0043646214180625975, 0.004275195351510774, 0.004255824023857713, 0.0042768006096594036],
    [0.003685277079057414, 0.003641246166807832, 0.0036031701711181086, 0.0038304319787130225, 0.0034156464607804082, 0.0035593357097241096, 0.0034630606933205854, 0.0034974023037648294, 0.003542271770129446, 0.003424375336180674],
    [0.0031008660243969643, 0.0031220683922583703, 0.0029948455448902678, 0.0033730489121808205, 0.003079849648202071, 0.0030551934742106823, 0.0030860730930726277, 0.0031103465971682454, 0.002995921931869816, 0.0030085539037827402],
    [0.0031736884693600587, 0.00324139352869679, 0.0033192017099281657, 0.003493117674224777, 0.0034368691785857663, 0.00332440185957239, 0.003329607466184825, 0.0033462787314419984, 0.003392347139197227, 0.0032834458352226648]
]

means = [np.mean(lst) for lst in data]
x_vals = np.array([2**i for i in range(12)])
log_x = np.log2(x_vals)

fig, ax = plt.subplots(figsize=(10, 6))

# Prepare data in bxp format
box_data = []
for i, d in enumerate(data):
    stats = {
        'med': np.median(d),
        'q1': np.percentile(d, 25),
        'q3': np.percentile(d, 75),
        'whislo': np.min(d),
        'whishi': np.max(d),
        'fliers': [],  # optionally add outliers here
        'mean': np.mean(d),
        'label': str(x_vals[i])
    }
    box_data.append(stats)

# Set x to log2, but keep spacing equal
ax.set_xscale("log", base=2)

# Plot each box manually using fixed width in log space
box_width_log = 0.2  # fixed width in log2 space
for i, (log_center, stats) in enumerate(zip(log_x, box_data)):
    x_center = 2 ** log_center
    ax.bxp([stats],
           positions=[x_center],
           widths=[x_center * (2**box_width_log - 2**(-box_width_log))],
           showmeans=True,
           patch_artist=True,
           boxprops=dict(facecolor='skyblue', alpha=0.6),
           meanprops=dict(marker='o', markerfacecolor='red', markersize=0),
           medianprops=dict(color='black')
    )

# Add mean trend line
ax.plot(x_vals, means, color='red', marker='o', linestyle='--', label='Mean Trend')

# Ticks and labels
ax.set_xticks(x_vals)
ax.set_xticklabels([str(x) for x in x_vals], rotation=45)
ax.set_xlabel("Quote Chunk Size (logâ‚‚ scale)")
ax.set_ylabel("Quote Time (ms)")
ax.grid(axis='y', linestyle='--', alpha=0.7)

plt.tight_layout()
plt.savefig("chunk_quote_performance.png", dpi=300)
# plt.show()